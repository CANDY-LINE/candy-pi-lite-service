#!/bin/bash
# ppp.ip-up hook script for DNS settings

PRODUCT="CANDY Pi Lite Board"
PRODUCT_DIR_NAME="candy-pi-lite"
DEBUG=""
conf=""

[ -x /sbin/resolvconf ] || exit 0
. /opt/candy-line/${PRODUCT_DIR_NAME}/_common.sh > /dev/null 2>&1
[ -f ${PPPD_RUNNING_FILE} ] || exit 0
load_apn

if [ -n "$APN_IPV6DNS1" -o -n "$APN_IPV6DNS2" ]; then
	conf="# Generated by CANDY Pi Lite Service ppp.ip-up hook for $PPP_IFACE\n"
	[ -n "$APN_IPV6DNS1" ] && conf="${conf}nameserver $APN_IPV6DNS1\n"
	[ -n "$APN_IPV6DNS2" ] && conf="${conf}nameserver $APN_IPV6DNS2\n"
fi

if [ "$APN_PDP" == "ipv4v6" ]; then
	conf="$conf\n`/sbin/resolvconf -l $PPP_IFACE | sed '1d'`"
fi

if [ -n "$conf" ]; then
	printf "$conf" | /sbin/resolvconf -a "$PPP_IFACE"
	log "[INFO] IPv6 resolv.conf has been updated."
else
	log "[WARN] IPv6 resolv.conf has NOT been updated."
fi
